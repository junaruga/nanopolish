# travis.yml for github.com/jts/nanopolish

dist: trusty
sudo: false
language: generic
cache: apt
git:
  depth: 1

matrix:
  include:
    # Set env for both nanoplish and the dependency hdf5.
    - env:
      - CC=gcc-4.8
      - CXX=g++-4.8
    - env:
      - CC=gcc-8
      - CXX=g++-8
      - AR=gcc-ar-8
      - NM=gcc-nm-8
      - RANLIB=gcc-ranlib-8

# Install and export newer gcc
before_install:
    - sudo add-apt-repository -y ppa:ubuntu-toolchain-r/test
    - sudo apt-get update -qq
    - |
      if [[ "${CC}" =~ ^gcc- ]]; then
        echo "Installing ${CC}."
        sudo apt-get install -qq "${CC}"
      fi
    - |
      if [[ "${CXX}" =~ ^g\+\+- ]]; then
        echo "Installing ${CXX}."
        sudo apt-get install -qq "${CXX}"
      fi
    - |
      JOBS="-j$(nproc)"

script:
  - |
    echo "JOBS=${JOBS}"
  - |
    make -s ${JOBS} nanopolish MKFLAGS="-s ${JOBS}" && make test
